# v3.0 — Supabase Auth (1.1) — Implementation Log

**Status:** ✅ DONE (shipped with v3.0)

## What Was Planned
- Email + magic link authentication (free, no password management)
- Google OAuth (free via Supabase, massive adoption boost)
- GitHub OAuth (developer audience)
- Row-Level Security (RLS) on all tables — data isolation per user
- Migration path: existing anon-key users get a "claim your data" flow
- Demo mode remains unchanged (no auth needed)

## Schema Changes
```sql
-- Add user_id to all tables
ALTER TABLE bookmarks ADD COLUMN user_id UUID REFERENCES auth.users(id);
ALTER TABLE tag_areas ADD COLUMN user_id UUID REFERENCES auth.users(id);
ALTER TABLE status_history ADD COLUMN user_id UUID REFERENCES auth.users(id);

-- RLS policies
CREATE POLICY "Users see own bookmarks" ON bookmarks
  FOR ALL USING (auth.uid() = user_id);
```

## What Shipped
- AuthScreen with magic link + Google + GitHub OAuth, demo mode preserved
- RLS policies, `set_user_id()` trigger, env-var singleton Supabase client
- Legacy credential flow removed (useCredentials, SetupScreen, bookmarklet code)

## What Broke (Intentional Clean Break)
- Existing data invisible — old rows with `user_id = NULL` don't match RLS
- Bookmarklet removed — relied on raw anon key embedded in JS
- iOS Shortcut broken — relied on raw anon key in HTTP headers

## Key Decisions
- Clean break over migration — simpler, no legacy data issues
- `set_user_id()` trigger auto-sets user_id on insert via `auth.uid()`
- No separate callback page — `onAuthStateChange` detects session from URL hash
