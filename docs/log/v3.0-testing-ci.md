# Phase 1.6 — Component Tests + GitHub Actions CI

**Date:** 2026-02-18
**Status:** Shipped

## What shipped

### Unit tests (62 tests across 4 files) — prior commit `ab65de3`

| File | Tests | Coverage |
|------|-------|----------|
| `utils.test.ts` | 32 | `detectSourceType`, `timeAgo`, `localDateString`, `truncate`, `getDomain`, `debounce`, `formatDate` |
| `metadata.test.ts` | 13 | YouTube oEmbed/Data API, Twitter oEmbed, Microlink fallback, title extraction |
| `ai.test.ts` | 12 | OpenRouter prompt construction, retry logic, free model selection, error handling |
| `useBookmarks.test.ts` | 5 | TanStack Query hook: fetch, add, update, delete, optimistic rollback |

### Component tests (33 new tests across 5 files)

| File | Tests | Coverage |
|------|-------|----------|
| `App.test.tsx` | 6 | Auth routing, loading state, demo mode bypass, share target URL |
| `AuthScreen.test.tsx` | 8 | Magic link flow, OAuth buttons, demo button, error toast, form reset |
| `AddBookmarkModal.test.tsx` | 7 | URL source detection, form submit, validation, pre-fill, pending state |
| `BookmarkCard.test.tsx` | 8 | Status cycling, favorite toggle, delete confirm, tag overflow, area pills |
| `StatusFilters.test.tsx` | 4 | Tab counts, status toggle, ARIA selected state |

**Total test count:** 95 (62 unit + 33 component)

### GitHub Actions CI

`.github/workflows/ci.yml` — runs on PRs to `main` and pushes to `main`:

1. `npm run format:check`
2. `npm run lint`
3. `npm run typecheck`
4. `npm run test`
5. `npm run build`

Node 20 LTS, npm cache for speed.

### Infrastructure changes

- Added `@testing-library/user-event` + `@testing-library/jest-dom` devDeps
- Extended `vite.config.ts` test include to `*.test.{ts,tsx}`
- Added `afterEach(cleanup)` + jest-dom matchers to `src/test/setup.ts`

## Decisions

- **Playwright E2E deferred** — overkill for a personal app with strong unit + component coverage
- **Component mocking strategy** — heavy child components (Dashboard, AuthScreen) stubbed as simple divs with data-testid to avoid rendering the full tree
- **`@testing-library/user-event`** over `fireEvent` — more realistic user interaction simulation
- **Single CI job** — no parallelism needed at this scale; sequential steps fail fast

## Testing patterns established

- Mock context providers (`useUI`, `useAuth`) at module level with `vi.mock`
- Use `ToastProvider` wrapper for components that call `useToast`
- Factory functions (`makeBookmark`, `authState`) for test data
- `vi.spyOn(window, 'confirm')` for delete confirmation dialogs
