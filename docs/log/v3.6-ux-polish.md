# v3.6 — UX Polish

**Date:** 2026-02-21
**Branch:** main
**Changes:** 7 UX fixes shipped

---

## What shipped

### Bug Fixes

**1. Close (X) button invisible on dark backgrounds**
Added `text-surface-700 dark:text-surface-200` to all close button classNames in `Modal.tsx`, `NoteEditorModal.tsx`, and `DetailPanel.tsx`. Root cause: icon inherited ancestor text color with no dark override.

**2. TipTap editor text black on dark background**
Added `[&_.tiptap]:text-surface-900 dark:[&_.tiptap]:text-surface-100` to `TipTapEditor.tsx` EditorContent className. Replaced non-functional `prose prose-sm dark:prose-invert` (requires `@tailwindcss/typography`, not installed) with `text-sm leading-relaxed`.

---

### Scratchpad System (replaces typed notes)

**3. Scratchpad replaces typed notes**
- `sql/migrations/add-scratchpad.sql` — adds `scratchpad TEXT NOT NULL DEFAULT ''` column; migrates existing typed notes to markdown with `## Type` headers
- `Bookmark` type gains `scratchpad: string` field
- `useBookmarks` replaces `addNote`/`deleteNote` mutations with `updateScratchpad` (optimistic, silent on error)
- Demo data updated with `scratchpad` on all 15 bookmarks
- `NoteComposer.tsx`, `NoteCard.tsx`, `NotesTab.tsx` deleted

---

### New Components & UI

**4. BookmarkScratchpad component** (`src/components/detail/BookmarkScratchpad.tsx`)
View/edit toggle — markdown preview via `ReactMarkdown` in view mode, plain textarea in edit mode. 1-second debounced save, resets on bookmark switch, flushes on unmount. "→ Note" button shown when `onConvertToNote` provided and scratchpad non-empty.

**5. TipTapEditor — isEditable prop**
New optional `isEditable?: boolean` prop (defaults `true`). Toolbar hidden when not editable. `editor.setEditable()` called on prop change.

**6. NoteEditorModal — view/edit toggle**
Opens in view mode (read-only). Edit/Done button in header. Click-to-edit on title and content area. Auto-save guarded to only trigger when `isEditing`.

---

### Layout & Architecture

**7. DetailPanel unified to centered popup modal**
Removed both mobile (slide-up) and desktop (right sidebar) implementations. Replaced with single centered overlay `max-w-lg` modal. Works on all viewport sizes with `max-h-[88vh]`. ESC to close, backdrop click to close.

**8. Convert-to-note button**
`handleConvertToNote` in Dashboard creates a `StandaloneNote` from the scratchpad content, then opens NoteEditorModal with the new note and the source bookmark linked.

**9. Editable bookmark title** (`MetadataHeader.tsx`)
Hover shows pencil icon. Click enters inline edit mode with bottom-border input. Enter saves, Escape cancels. Wired through `DetailPanel.onUpdateTitle` → `updateBookmark` mutation.

---

## Files changed

| File | Change |
|------|--------|
| `src/components/ui/Modal.tsx` | Close button text color |
| `src/components/notes/TipTapEditor.tsx` | Dark text fix, isEditable prop |
| `src/components/notes/NoteEditorModal.tsx` | Close button color, isEditing toggle |
| `src/components/detail/DetailPanel.tsx` | Unified modal, scratchpad, title edit props |
| `src/components/detail/MetadataHeader.tsx` | Inline title editing |
| `src/components/detail/BookmarkScratchpad.tsx` | **NEW** — scratchpad component |
| `src/types/index.ts` | `scratchpad: string` on Bookmark |
| `src/hooks/useBookmarks.ts` | `updateScratchpad`, removed addNote/deleteNote |
| `src/lib/demo-data.ts` | `scratchpad` on all 15 demo bookmarks |
| `src/pages/Dashboard.tsx` | All wiring |
| `sql/migrations/add-scratchpad.sql` | **NEW** — DB migration |

**Deleted:**
- `src/components/detail/NoteComposer.tsx`
- `src/components/detail/NoteCard.tsx`
- `src/components/detail/NotesTab.tsx`
